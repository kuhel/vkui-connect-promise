!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self)["VKUI-Connect-Promise"]=t()}(this,function(){"use strict";function o(){return(o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e}).apply(this,arguments)}window.CustomEvent||function(){function e(e,t){t=t||{bubbles:!1,cancelable:!1,detail:void 0};var n=document.createEvent("CustomEvent");return n.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),n}e.prototype=window.Event.prototype,window.CustomEvent=e}();var s="function",u="undefined",d=typeof window!==u&&!window.AndroidBridge&&!window.webkit,e=d?"message":"VKWebAppEvent",c={},p=0;return window.addEventListener(e,function(e){var t=null,n={};d?e.data&&e.data.data&&(n=o({},e.data),t=c[n.data.request_id]):e.detail&&e.detail.data&&(n=o({},e.detail),t=c[n.data.request_id]),n.data&&n.data.request_id&&(t=c[n.data.request_id])&&(t.customRequestId&&delete n.data.request_id,n.data.error_type?t.reject(n):t.resolve(n))}),{send:function(e,n){n||(n={});var t=typeof window!==u,o=t&&window.AndroidBridge,d=t&&window.webkit&&window.webkit.messageHandlers,i=!o&&!d,a=n.request_id?n.request_id:"method#"+p++,r=!1;return n.hasOwnProperty("request_id")||(r=!0,n.request_id=a),o&&typeof o[e]===s&&o[e](JSON.stringify(n)),d&&d[e]&&typeof d[e].postMessage===s&&d[e].postMessage(n),i&&parent.postMessage({handler:e,params:n,type:"vk-connect"},"*"),new Promise(function(e,t){c[a]={resolve:e,reject:t,params:n,customRequestId:r}})}}});
